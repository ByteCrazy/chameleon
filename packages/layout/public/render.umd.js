(function(j,T){typeof exports=="object"&&typeof module<"u"?T(exports,require("react"),require("react-dom")):typeof define=="function"&&define.amd?define(["exports","react","react-dom"],T):(j=typeof globalThis<"u"?globalThis:j||self,T(j.CRender={},j.React,j.ReactDOM))})(this,function(j,T,nt){"use strict";var hf=Object.defineProperty;var vf=(j,T,nt)=>T in j?hf(j,T,{enumerable:!0,configurable:!0,writable:!0,value:nt}):j[T]=nt;var _=(j,T,nt)=>(vf(j,typeof T!="symbol"?T+"":T,nt),nt);const An=t=>t&&typeof t=="object"&&"default"in t?t:{default:t};function Mn(t){if(t&&t.__esModule)return t;const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const r in t)if(r!=="default"){const n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:()=>t[r]})}}return e.default=t,Object.freeze(e)}const k=An(T),$n=Mn(nt),Pn=t=>()=>{console.warn(`${t} need to be implement getComponent`)},Tn=["customPageRootRender"],Ge=["pageRender","render","convertModelToComponent","getComponent","getContext","getUtils","getDataLink","createDataLink","transformProps","transformData","transformGlobalData","errorCatch","clear"],ze=t=>[...Ge,...Tn].reduce((r,n)=>{var o;return t!=null&&t[n]?r[n]=(o=t[n])==null?void 0:o.bind(t):Ge.includes(n)&&(r[n]=Pn),r},{});var Rn=Object.defineProperty,xn=(t,e,r)=>e in t?Rn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y=(t,e,r)=>(xn(t,typeof e!="symbol"?e+"":e,r),r);class Ve extends TypeError{constructor(e,r){let n;const{message:o,...a}=e,{path:s}=e,i=s.length===0?o:`At path: ${s.join(".")} -- ${o}`;super(i),this.value=void 0,this.key=void 0,this.type=void 0,this.refinement=void 0,this.path=void 0,this.branch=void 0,this.failures=void 0,Object.assign(this,a),this.name=this.constructor.name,this.failures=()=>n!=null?n:n=[e,...r()]}}function Dn(t){return G(t)&&typeof t[Symbol.iterator]=="function"}function G(t){return typeof t=="object"&&t!=null}function F(t){return typeof t=="symbol"?t.toString():typeof t=="string"?JSON.stringify(t):`${t}`}function In(t){const{done:e,value:r}=t.next();return e?void 0:r}function kn(t,e,r,n){if(t===!0)return;t===!1?t={}:typeof t=="string"&&(t={message:t});const{path:o,branch:a}=e,{type:s}=r,{refinement:i,message:c=`Expected a value of type \`${s}\`${i?` with refinement \`${i}\``:""}, but received: \`${F(n)}\``}=t;return{value:n,type:s,refinement:i,key:o[o.length-1],path:o,branch:a,...t,message:c}}function*We(t,e,r,n){Dn(t)||(t=[t]);for(const o of t){const a=kn(o,e,r,n);a&&(yield a)}}function*Wt(t,e,r){r===void 0&&(r={});const{path:n=[],branch:o=[t],coerce:a=!1,mask:s=!1}=r,i={path:n,branch:o};if(a&&(t=e.coercer(t,i),s&&e.type!=="type"&&G(e.schema)&&G(t)&&!Array.isArray(t)))for(const u in t)e.schema[u]===void 0&&delete t[u];let c="valid";for(const u of e.validator(t,i))c="not_valid",yield[u,void 0];for(let[u,f,d]of e.entries(t,i)){const l=Wt(f,d,{path:u===void 0?n:[...n,u],branch:u===void 0?o:[...o,f],coerce:a,mask:s});for(const h of l)h[0]?(c=h[0].refinement!=null?"not_refined":"not_valid",yield[h[0],void 0]):a&&(f=h[1],u===void 0?t=f:t instanceof Map?t.set(u,f):t instanceof Set?t.add(f):G(t)&&(f!==void 0||u in t)&&(t[u]=f))}if(c!=="not_valid")for(const u of e.refiner(t,i))c="not_refined",yield[u,void 0];c==="valid"&&(yield[void 0,t])}class W{constructor(e){this.TYPE=void 0,this.type=void 0,this.schema=void 0,this.coercer=void 0,this.validator=void 0,this.refiner=void 0,this.entries=void 0;const{type:r,schema:n,validator:o,refiner:a,coercer:s=c=>c,entries:i=function*(){}}=e;this.type=r,this.schema=n,this.entries=i,this.coercer=s,o?this.validator=(c,u)=>{const f=o(c,u);return We(f,u,this,c)}:this.validator=()=>[],a?this.refiner=(c,u)=>{const f=a(c,u);return We(f,u,this,c)}:this.refiner=()=>[]}assert(e){return He(e,this)}create(e){return Fn(e,this)}is(e){return Bn(e,this)}mask(e){return Ln(e,this)}validate(e,r){return r===void 0&&(r={}),lt(e,this,r)}}function He(t,e){const r=lt(t,e);if(r[0])throw r[0]}function Fn(t,e){const r=lt(t,e,{coerce:!0});if(r[0])throw r[0];return r[1]}function Ln(t,e){const r=lt(t,e,{coerce:!0,mask:!0});if(r[0])throw r[0];return r[1]}function Bn(t,e){return!lt(t,e)[0]}function lt(t,e,r){r===void 0&&(r={});const n=Wt(t,e,r),o=In(n);return o[0]?[new Ve(o[0],function*(){for(const a of n)a[0]&&(yield a[0])}),void 0]:[void 0,o[1]]}function Ht(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n=e[0].type==="type",o=e.map(s=>s.schema),a=Object.assign({},...o);return n?qe(a):S(a)}function K(t,e){return new W({type:t,schema:null,validator:e})}function ft(t){return new W({type:"dynamic",schema:null,*entries(e,r){yield*t(e,r).entries(e,r)},validator(e,r){return t(e,r).validator(e,r)},coercer(e,r){return t(e,r).coercer(e,r)},refiner(e,r){return t(e,r).refiner(e,r)}})}function Qe(t,e){const{schema:r}=t,n={...r};for(const o of e)delete n[o];switch(t.type){case"type":return qe(n);default:return S(n)}}function z(){return K("any",()=>!0)}function x(t){return new W({type:"array",schema:t,*entries(e){if(t&&Array.isArray(e))for(const[r,n]of e.entries())yield[r,n,t]},coercer(e){return Array.isArray(e)?e.slice():e},validator(e){return Array.isArray(e)||`Expected an array value, but received: ${F(e)}`}})}function J(){return K("boolean",t=>typeof t=="boolean")}function Qt(t){const e={},r=t.map(n=>F(n)).join();for(const n of t)e[n]=n;return new W({type:"enums",schema:e,validator(n){return t.includes(n)||`Expected one of \`${r}\`, but received: ${F(n)}`}})}function Je(){return K("func",t=>typeof t=="function"||`Expected a function, but received: ${F(t)}`)}function I(t){const e=F(t),r=typeof t;return new W({type:"literal",schema:r==="string"||r==="number"||r==="boolean"?t:null,validator(n){return n===t||`Expected the literal \`${e}\`, but received: ${F(n)}`}})}function Un(){return K("never",()=>!1)}function Ye(){return K("number",t=>typeof t=="number"&&!isNaN(t)||`Expected a number, but received: ${F(t)}`)}function S(t){const e=t?Object.keys(t):[],r=Un();return new W({type:"object",schema:t||null,*entries(n){if(t&&G(n)){const o=new Set(Object.keys(n));for(const a of e)o.delete(a),yield[a,n[a],t[a]];for(const a of o)yield[a,n[a],r]}},validator(n){return G(n)||`Expected an object, but received: ${F(n)}`},coercer(n){return G(n)?{...n}:n}})}function v(t){return new W({...t,validator:(e,r)=>e===void 0||t.validator(e,r),refiner:(e,r)=>e===void 0||t.refiner(e,r)})}function jt(t,e){return new W({type:"record",schema:null,*entries(r){if(G(r))for(const n in r){const o=r[n];yield[n,n,t],yield[n,o,e]}},validator(r){return G(r)||`Expected an object, but received: ${F(r)}`}})}function p(){return K("string",t=>typeof t=="string"||`Expected a string, but received: ${F(t)}`)}function qe(t){const e=Object.keys(t);return new W({type:"type",schema:t,*entries(r){if(G(r))for(const n of e)yield[n,r[n],t[n]]},validator(r){return G(r)||`Expected an object, but received: ${F(r)}`}})}function R(t){const e=t.map(r=>r.type).join(" | ");return new W({type:"union",schema:null,coercer(r,n){return(t.find(o=>{const[a]=o.validate(r,{coerce:!0});return!a})||Gn()).coercer(r,n)},validator(r,n){const o=[];for(const a of t){const[...s]=Wt(r,a,n),[i]=s;if(i[0])for(const[c]of s)c&&o.push(c);else return[]}return[`Expected the value to satisfy a union of \`${e}\`, but received: ${F(r)}`,...o]}})}function Gn(){return K("unknown",()=>!0)}const Jt=S({package:p(),version:p(),exportName:p(),destructuring:v(J()),subName:v(p()),main:v(p())}),zn=R([S({globName:p(),type:I(["CDN"]),content:R([Jt])}),S({globName:p(),type:I(["FUNCTION"]),content:R([p()])})]);var V=(t=>(t.SLOT="SLOT",t.FUNCTION="FUNCTION",t.EXPRESSION="EXPRESSION",t))(V||{}),Yt=(t=>(t.DESIGN="design",t.SAVE="save",t))(Yt||{}),qt=(t=>(t.FUNC="FUNC",t.COMP="COMP",t))(qt||{}),Vn=typeof global=="object"&&global&&global.Object===Object&&global;const Xe=Vn;var Wn=typeof self=="object"&&self&&self.Object===Object&&self,Hn=Xe||Wn||Function("return this")();const H=Hn;var Qn=H.Symbol;const B=Qn;var Ze=Object.prototype,Jn=Ze.hasOwnProperty,Yn=Ze.toString,wt=B?B.toStringTag:void 0;function qn(t){var e=Jn.call(t,wt),r=t[wt];try{t[wt]=void 0;var n=!0}catch{}var o=Yn.call(t);return n&&(e?t[wt]=r:delete t[wt]),o}var Xn=Object.prototype,Zn=Xn.toString;function Kn(t){return Zn.call(t)}var to="[object Null]",eo="[object Undefined]",Ke=B?B.toStringTag:void 0;function ot(t){return t==null?t===void 0?eo:to:Ke&&Ke in Object(t)?qn(t):Kn(t)}function Y(t){return t!=null&&typeof t=="object"}var ro="[object Symbol]";function Xt(t){return typeof t=="symbol"||Y(t)&&ot(t)==ro}function Zt(t,e){for(var r=-1,n=t==null?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}var no=Array.isArray;const P=no;var oo=1/0,tr=B?B.prototype:void 0,er=tr?tr.toString:void 0;function rr(t){if(typeof t=="string")return t;if(P(t))return Zt(t,rr)+"";if(Xt(t))return er?er.call(t):"";var e=t+"";return e=="0"&&1/t==-oo?"-0":e}function tt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function nr(t){return t}var ao="[object AsyncFunction]",io="[object Function]",so="[object GeneratorFunction]",co="[object Proxy]";function or(t){if(!tt(t))return!1;var e=ot(t);return e==io||e==so||e==ao||e==co}var uo=H["__core-js_shared__"];const Kt=uo;var ar=function(){var t=/[^.]+$/.exec(Kt&&Kt.keys&&Kt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function lo(t){return!!ar&&ar in t}var fo=Function.prototype,po=fo.toString;function at(t){if(t!=null){try{return po.call(t)}catch{}try{return t+""}catch{}}return""}var ho=/[\\^$.*+?()[\]{}|]/g,vo=/^\[object .+?Constructor\]$/,mo=Function.prototype,yo=Object.prototype,go=mo.toString,bo=yo.hasOwnProperty,jo=RegExp("^"+go.call(bo).replace(ho,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function wo(t){if(!tt(t)||lo(t))return!1;var e=or(t)?jo:vo;return e.test(at(t))}function _o(t,e){return t==null?void 0:t[e]}function it(t,e){var r=_o(t,e);return wo(r)?r:void 0}var So=it(H,"WeakMap");const te=So;var ir=Object.create,Oo=function(){function t(){}return function(e){if(!tt(e))return{};if(ir)return ir(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();const Co=Oo;function Eo(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function No(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}var Ao=800,Mo=16,$o=Date.now;function Po(t){var e=0,r=0;return function(){var n=$o(),o=Mo-(n-r);if(r=n,o>0){if(++e>=Ao)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function To(t){return function(){return t}}var Ro=function(){try{var t=it(Object,"defineProperty");return t({},"",{}),t}catch{}}();const $t=Ro;var xo=$t?function(t,e){return $t(t,"toString",{configurable:!0,enumerable:!1,value:To(e),writable:!0})}:nr,Do=Po(xo);const Io=Do;function ko(t,e){for(var r=-1,n=t==null?0:t.length;++r<n&&e(t[r],r,t)!==!1;);return t}var Fo=9007199254740991,Lo=/^(?:0|[1-9]\d*)$/;function ee(t,e){var r=typeof t;return e=e==null?Fo:e,!!e&&(r=="number"||r!="symbol"&&Lo.test(t))&&t>-1&&t%1==0&&t<e}function sr(t,e,r){e=="__proto__"&&$t?$t(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function re(t,e){return t===e||t!==t&&e!==e}var Bo=Object.prototype,Uo=Bo.hasOwnProperty;function ne(t,e,r){var n=t[e];(!(Uo.call(t,e)&&re(n,r))||r===void 0&&!(e in t))&&sr(t,e,r)}function _t(t,e,r,n){var o=!r;r||(r={});for(var a=-1,s=e.length;++a<s;){var i=e[a],c=n?n(r[i],t[i],i,r,t):void 0;c===void 0&&(c=t[i]),o?sr(r,i,c):ne(r,i,c)}return r}var cr=Math.max;function Go(t,e,r){return e=cr(e===void 0?t.length-1:e,0),function(){for(var n=arguments,o=-1,a=cr(n.length-e,0),s=Array(a);++o<a;)s[o]=n[e+o];o=-1;for(var i=Array(e+1);++o<e;)i[o]=n[o];return i[e]=r(s),Eo(t,this,i)}}var zo=9007199254740991;function oe(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=zo}function ur(t){return t!=null&&oe(t.length)&&!or(t)}var Vo=Object.prototype;function ae(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Vo;return t===r}function Wo(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var Ho="[object Arguments]";function lr(t){return Y(t)&&ot(t)==Ho}var fr=Object.prototype,Qo=fr.hasOwnProperty,Jo=fr.propertyIsEnumerable,Yo=lr(function(){return arguments}())?lr:function(t){return Y(t)&&Qo.call(t,"callee")&&!Jo.call(t,"callee")};const ie=Yo;function qo(){return!1}var pr=typeof j=="object"&&j&&!j.nodeType&&j,dr=pr&&typeof module=="object"&&module&&!module.nodeType&&module,Xo=dr&&dr.exports===pr,hr=Xo?H.Buffer:void 0,Zo=hr?hr.isBuffer:void 0,Ko=Zo||qo;const Pt=Ko;var ta="[object Arguments]",ea="[object Array]",ra="[object Boolean]",na="[object Date]",oa="[object Error]",aa="[object Function]",ia="[object Map]",sa="[object Number]",ca="[object Object]",ua="[object RegExp]",la="[object Set]",fa="[object String]",pa="[object WeakMap]",da="[object ArrayBuffer]",ha="[object DataView]",va="[object Float32Array]",ma="[object Float64Array]",ya="[object Int8Array]",ga="[object Int16Array]",ba="[object Int32Array]",ja="[object Uint8Array]",wa="[object Uint8ClampedArray]",_a="[object Uint16Array]",Sa="[object Uint32Array]",E={};E[va]=E[ma]=E[ya]=E[ga]=E[ba]=E[ja]=E[wa]=E[_a]=E[Sa]=!0,E[ta]=E[ea]=E[da]=E[ra]=E[ha]=E[na]=E[oa]=E[aa]=E[ia]=E[sa]=E[ca]=E[ua]=E[la]=E[fa]=E[pa]=!1;function Oa(t){return Y(t)&&oe(t.length)&&!!E[ot(t)]}function se(t){return function(e){return t(e)}}var vr=typeof j=="object"&&j&&!j.nodeType&&j,St=vr&&typeof module=="object"&&module&&!module.nodeType&&module,Ca=St&&St.exports===vr,ce=Ca&&Xe.process,Ea=function(){try{var t=St&&St.require&&St.require("util").types;return t||ce&&ce.binding&&ce.binding("util")}catch{}}();const pt=Ea;var mr=pt&&pt.isTypedArray,Na=mr?se(mr):Oa;const yr=Na;var Aa=Object.prototype,Ma=Aa.hasOwnProperty;function gr(t,e){var r=P(t),n=!r&&ie(t),o=!r&&!n&&Pt(t),a=!r&&!n&&!o&&yr(t),s=r||n||o||a,i=s?Wo(t.length,String):[],c=i.length;for(var u in t)(e||Ma.call(t,u))&&!(s&&(u=="length"||o&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||ee(u,c)))&&i.push(u);return i}function br(t,e){return function(r){return t(e(r))}}var $a=br(Object.keys,Object);const Pa=$a;var Ta=Object.prototype,Ra=Ta.hasOwnProperty;function xa(t){if(!ae(t))return Pa(t);var e=[];for(var r in Object(t))Ra.call(t,r)&&r!="constructor"&&e.push(r);return e}function Tt(t){return ur(t)?gr(t):xa(t)}function Da(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var Ia=Object.prototype,ka=Ia.hasOwnProperty;function Fa(t){if(!tt(t))return Da(t);var e=ae(t),r=[];for(var n in t)n=="constructor"&&(e||!ka.call(t,n))||r.push(n);return r}function ue(t){return ur(t)?gr(t,!0):Fa(t)}var La=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ba=/^\w*$/;function le(t,e){if(P(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||Xt(t)?!0:Ba.test(t)||!La.test(t)||e!=null&&t in Object(e)}var Ua=it(Object,"create");const Ot=Ua;function Ga(){this.__data__=Ot?Ot(null):{},this.size=0}function za(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Va="__lodash_hash_undefined__",Wa=Object.prototype,Ha=Wa.hasOwnProperty;function Qa(t){var e=this.__data__;if(Ot){var r=e[t];return r===Va?void 0:r}return Ha.call(e,t)?e[t]:void 0}var Ja=Object.prototype,Ya=Ja.hasOwnProperty;function qa(t){var e=this.__data__;return Ot?e[t]!==void 0:Ya.call(e,t)}var Xa="__lodash_hash_undefined__";function Za(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Ot&&e===void 0?Xa:e,this}function st(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}st.prototype.clear=Ga,st.prototype.delete=za,st.prototype.get=Qa,st.prototype.has=qa,st.prototype.set=Za;function Ka(){this.__data__=[],this.size=0}function Rt(t,e){for(var r=t.length;r--;)if(re(t[r][0],e))return r;return-1}var ti=Array.prototype,ei=ti.splice;function ri(t){var e=this.__data__,r=Rt(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():ei.call(e,r,1),--this.size,!0}function ni(t){var e=this.__data__,r=Rt(e,t);return r<0?void 0:e[r][1]}function oi(t){return Rt(this.__data__,t)>-1}function ai(t,e){var r=this.__data__,n=Rt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function q(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}q.prototype.clear=Ka,q.prototype.delete=ri,q.prototype.get=ni,q.prototype.has=oi,q.prototype.set=ai;var ii=it(H,"Map");const Ct=ii;function si(){this.size=0,this.__data__={hash:new st,map:new(Ct||q),string:new st}}function ci(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function xt(t,e){var r=t.__data__;return ci(e)?r[typeof e=="string"?"string":"hash"]:r.map}function ui(t){var e=xt(this,t).delete(t);return this.size-=e?1:0,e}function li(t){return xt(this,t).get(t)}function fi(t){return xt(this,t).has(t)}function pi(t,e){var r=xt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function X(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}X.prototype.clear=si,X.prototype.delete=ui,X.prototype.get=li,X.prototype.has=fi,X.prototype.set=pi;var di="Expected a function";function fe(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(di);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var s=t.apply(this,n);return r.cache=a.set(o,s)||a,s};return r.cache=new(fe.Cache||X),r}fe.Cache=X;var hi=500;function vi(t){var e=fe(t,function(n){return r.size===hi&&r.clear(),n}),r=e.cache;return e}var mi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,yi=/\\(\\)?/g,gi=vi(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(mi,function(r,n,o,a){e.push(o?a.replace(yi,"$1"):n||r)}),e});const bi=gi;function ji(t){return t==null?"":rr(t)}function dt(t,e){return P(t)?t:le(t,e)?[t]:bi(ji(t))}var wi=1/0;function ht(t){if(typeof t=="string"||Xt(t))return t;var e=t+"";return e=="0"&&1/t==-wi?"-0":e}function Dt(t,e){e=dt(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[ht(e[r++])];return r&&r==n?t:void 0}function _i(t,e,r){var n=t==null?void 0:Dt(t,e);return n===void 0?r:n}function pe(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}var jr=B?B.isConcatSpreadable:void 0;function Si(t){return P(t)||ie(t)||!!(jr&&t&&t[jr])}function wr(t,e,r,n,o){var a=-1,s=t.length;for(r||(r=Si),o||(o=[]);++a<s;){var i=t[a];e>0&&r(i)?e>1?wr(i,e-1,r,n,o):pe(o,i):n||(o[o.length]=i)}return o}function Oi(t){var e=t==null?0:t.length;return e?wr(t,1):[]}function Ci(t){return Io(Go(t,void 0,Oi),t+"")}var Ei=br(Object.getPrototypeOf,Object);const de=Ei;var Ni="[object Object]",Ai=Function.prototype,Mi=Object.prototype,_r=Ai.toString,$i=Mi.hasOwnProperty,Pi=_r.call(Object);function L(t){if(!Y(t)||ot(t)!=Ni)return!1;var e=de(t);if(e===null)return!0;var r=$i.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&_r.call(r)==Pi}function Ti(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),r=r>o?o:r,r<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var a=Array(o);++n<o;)a[n]=t[n+e];return a}function Ri(){this.__data__=new q,this.size=0}function xi(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function Di(t){return this.__data__.get(t)}function Ii(t){return this.__data__.has(t)}var ki=200;function Fi(t,e){var r=this.__data__;if(r instanceof q){var n=r.__data__;if(!Ct||n.length<ki-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new X(n)}return r.set(t,e),this.size=r.size,this}function Q(t){var e=this.__data__=new q(t);this.size=e.size}Q.prototype.clear=Ri,Q.prototype.delete=xi,Q.prototype.get=Di,Q.prototype.has=Ii,Q.prototype.set=Fi;function Li(t,e){return t&&_t(e,Tt(e),t)}function Bi(t,e){return t&&_t(e,ue(e),t)}var Sr=typeof j=="object"&&j&&!j.nodeType&&j,Or=Sr&&typeof module=="object"&&module&&!module.nodeType&&module,Ui=Or&&Or.exports===Sr,Cr=Ui?H.Buffer:void 0,Er=Cr?Cr.allocUnsafe:void 0;function Gi(t,e){if(e)return t.slice();var r=t.length,n=Er?Er(r):new t.constructor(r);return t.copy(n),n}function zi(t,e){for(var r=-1,n=t==null?0:t.length,o=0,a=[];++r<n;){var s=t[r];e(s,r,t)&&(a[o++]=s)}return a}function Nr(){return[]}var Vi=Object.prototype,Wi=Vi.propertyIsEnumerable,Ar=Object.getOwnPropertySymbols,Hi=Ar?function(t){return t==null?[]:(t=Object(t),zi(Ar(t),function(e){return Wi.call(t,e)}))}:Nr;const he=Hi;function Qi(t,e){return _t(t,he(t),e)}var Ji=Object.getOwnPropertySymbols,Yi=Ji?function(t){for(var e=[];t;)pe(e,he(t)),t=de(t);return e}:Nr;const Mr=Yi;function qi(t,e){return _t(t,Mr(t),e)}function $r(t,e,r){var n=e(t);return P(t)?n:pe(n,r(t))}function ve(t){return $r(t,Tt,he)}function me(t){return $r(t,ue,Mr)}var Xi=it(H,"DataView");const ye=Xi;var Zi=it(H,"Promise");const ge=Zi;var Ki=it(H,"Set");const be=Ki;var Pr="[object Map]",ts="[object Object]",Tr="[object Promise]",Rr="[object Set]",xr="[object WeakMap]",Dr="[object DataView]",es=at(ye),rs=at(Ct),ns=at(ge),os=at(be),as=at(te),ct=ot;(ye&&ct(new ye(new ArrayBuffer(1)))!=Dr||Ct&&ct(new Ct)!=Pr||ge&&ct(ge.resolve())!=Tr||be&&ct(new be)!=Rr||te&&ct(new te)!=xr)&&(ct=function(t){var e=ot(t),r=e==ts?t.constructor:void 0,n=r?at(r):"";if(n)switch(n){case es:return Dr;case rs:return Pr;case ns:return Tr;case os:return Rr;case as:return xr}return e});const Et=ct;var is=Object.prototype,ss=is.hasOwnProperty;function cs(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&ss.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var us=H.Uint8Array;const It=us;function je(t){var e=new t.constructor(t.byteLength);return new It(e).set(new It(t)),e}function ls(t,e){var r=e?je(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var fs=/\w*$/;function ps(t){var e=new t.constructor(t.source,fs.exec(t));return e.lastIndex=t.lastIndex,e}var Ir=B?B.prototype:void 0,kr=Ir?Ir.valueOf:void 0;function ds(t){return kr?Object(kr.call(t)):{}}function hs(t,e){var r=e?je(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var vs="[object Boolean]",ms="[object Date]",ys="[object Map]",gs="[object Number]",bs="[object RegExp]",js="[object Set]",ws="[object String]",_s="[object Symbol]",Ss="[object ArrayBuffer]",Os="[object DataView]",Cs="[object Float32Array]",Es="[object Float64Array]",Ns="[object Int8Array]",As="[object Int16Array]",Ms="[object Int32Array]",$s="[object Uint8Array]",Ps="[object Uint8ClampedArray]",Ts="[object Uint16Array]",Rs="[object Uint32Array]";function xs(t,e,r){var n=t.constructor;switch(e){case Ss:return je(t);case vs:case ms:return new n(+t);case Os:return ls(t,r);case Cs:case Es:case Ns:case As:case Ms:case $s:case Ps:case Ts:case Rs:return hs(t,r);case ys:return new n;case gs:case ws:return new n(t);case bs:return ps(t);case js:return new n;case _s:return ds(t)}}function Ds(t){return typeof t.constructor=="function"&&!ae(t)?Co(de(t)):{}}var Is="[object Map]";function ks(t){return Y(t)&&Et(t)==Is}var Fr=pt&&pt.isMap,Fs=Fr?se(Fr):ks;const Ls=Fs;var Bs="[object Set]";function Us(t){return Y(t)&&Et(t)==Bs}var Lr=pt&&pt.isSet,Gs=Lr?se(Lr):Us;const zs=Gs;var Vs=1,Ws=2,Hs=4,Br="[object Arguments]",Qs="[object Array]",Js="[object Boolean]",Ys="[object Date]",qs="[object Error]",Ur="[object Function]",Xs="[object GeneratorFunction]",Zs="[object Map]",Ks="[object Number]",Gr="[object Object]",tc="[object RegExp]",ec="[object Set]",rc="[object String]",nc="[object Symbol]",oc="[object WeakMap]",ac="[object ArrayBuffer]",ic="[object DataView]",sc="[object Float32Array]",cc="[object Float64Array]",uc="[object Int8Array]",lc="[object Int16Array]",fc="[object Int32Array]",pc="[object Uint8Array]",dc="[object Uint8ClampedArray]",hc="[object Uint16Array]",vc="[object Uint32Array]",O={};O[Br]=O[Qs]=O[ac]=O[ic]=O[Js]=O[Ys]=O[sc]=O[cc]=O[uc]=O[lc]=O[fc]=O[Zs]=O[Ks]=O[Gr]=O[tc]=O[ec]=O[rc]=O[nc]=O[pc]=O[dc]=O[hc]=O[vc]=!0,O[qs]=O[Ur]=O[oc]=!1;function Nt(t,e,r,n,o,a){var s,i=e&Vs,c=e&Ws,u=e&Hs;if(r&&(s=o?r(t,n,o,a):r(t)),s!==void 0)return s;if(!tt(t))return t;var f=P(t);if(f){if(s=cs(t),!i)return No(t,s)}else{var d=Et(t),l=d==Ur||d==Xs;if(Pt(t))return Gi(t,i);if(d==Gr||d==Br||l&&!o){if(s=c||l?{}:Ds(t),!i)return c?qi(t,Bi(s,t)):Qi(t,Li(s,t))}else{if(!O[d])return o?t:{};s=xs(t,d,i)}}a||(a=new Q);var h=a.get(t);if(h)return h;a.set(t,s),zs(t)?t.forEach(function(b){s.add(Nt(b,e,r,b,t,a))}):Ls(t)&&t.forEach(function(b,w){s.set(w,Nt(b,e,r,w,t,a))});var g=u?c?me:ve:c?ue:Tt,m=f?void 0:g(t);return ko(m||t,function(b,w){m&&(w=b,b=t[w]),ne(s,w,Nt(b,e,r,w,t,a))}),s}var mc=1,yc=4;function gc(t){return Nt(t,mc|yc)}var bc="__lodash_hash_undefined__";function jc(t){return this.__data__.set(t,bc),this}function wc(t){return this.__data__.has(t)}function kt(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new X;++e<r;)this.add(t[e])}kt.prototype.add=kt.prototype.push=jc,kt.prototype.has=wc;function _c(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function Sc(t,e){return t.has(e)}var Oc=1,Cc=2;function zr(t,e,r,n,o,a){var s=r&Oc,i=t.length,c=e.length;if(i!=c&&!(s&&c>i))return!1;var u=a.get(t),f=a.get(e);if(u&&f)return u==e&&f==t;var d=-1,l=!0,h=r&Cc?new kt:void 0;for(a.set(t,e),a.set(e,t);++d<i;){var g=t[d],m=e[d];if(n)var b=s?n(m,g,d,e,t,a):n(g,m,d,t,e,a);if(b!==void 0){if(b)continue;l=!1;break}if(h){if(!_c(e,function(w,C){if(!Sc(h,C)&&(g===w||o(g,w,r,n,a)))return h.push(C)})){l=!1;break}}else if(!(g===m||o(g,m,r,n,a))){l=!1;break}}return a.delete(t),a.delete(e),l}function Ec(t){var e=-1,r=Array(t.size);return t.forEach(function(n,o){r[++e]=[o,n]}),r}function Nc(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var Ac=1,Mc=2,$c="[object Boolean]",Pc="[object Date]",Tc="[object Error]",Rc="[object Map]",xc="[object Number]",Dc="[object RegExp]",Ic="[object Set]",kc="[object String]",Fc="[object Symbol]",Lc="[object ArrayBuffer]",Bc="[object DataView]",Vr=B?B.prototype:void 0,we=Vr?Vr.valueOf:void 0;function Uc(t,e,r,n,o,a,s){switch(r){case Bc:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Lc:return!(t.byteLength!=e.byteLength||!a(new It(t),new It(e)));case $c:case Pc:case xc:return re(+t,+e);case Tc:return t.name==e.name&&t.message==e.message;case Dc:case kc:return t==e+"";case Rc:var i=Ec;case Ic:var c=n&Ac;if(i||(i=Nc),t.size!=e.size&&!c)return!1;var u=s.get(t);if(u)return u==e;n|=Mc,s.set(t,e);var f=zr(i(t),i(e),n,o,a,s);return s.delete(t),f;case Fc:if(we)return we.call(t)==we.call(e)}return!1}var Gc=1,zc=Object.prototype,Vc=zc.hasOwnProperty;function Wc(t,e,r,n,o,a){var s=r&Gc,i=ve(t),c=i.length,u=ve(e),f=u.length;if(c!=f&&!s)return!1;for(var d=c;d--;){var l=i[d];if(!(s?l in e:Vc.call(e,l)))return!1}var h=a.get(t),g=a.get(e);if(h&&g)return h==e&&g==t;var m=!0;a.set(t,e),a.set(e,t);for(var b=s;++d<c;){l=i[d];var w=t[l],C=e[l];if(n)var M=s?n(C,w,l,e,t,a):n(w,C,l,t,e,a);if(!(M===void 0?w===C||o(w,C,r,n,a):M)){m=!1;break}b||(b=l=="constructor")}if(m&&!b){var $=t.constructor,D=e.constructor;$!=D&&"constructor"in t&&"constructor"in e&&!(typeof $=="function"&&$ instanceof $&&typeof D=="function"&&D instanceof D)&&(m=!1)}return a.delete(t),a.delete(e),m}var Hc=1,Wr="[object Arguments]",Hr="[object Array]",Ft="[object Object]",Qc=Object.prototype,Qr=Qc.hasOwnProperty;function Jc(t,e,r,n,o,a){var s=P(t),i=P(e),c=s?Hr:Et(t),u=i?Hr:Et(e);c=c==Wr?Ft:c,u=u==Wr?Ft:u;var f=c==Ft,d=u==Ft,l=c==u;if(l&&Pt(t)){if(!Pt(e))return!1;s=!0,f=!1}if(l&&!f)return a||(a=new Q),s||yr(t)?zr(t,e,r,n,o,a):Uc(t,e,c,r,n,o,a);if(!(r&Hc)){var h=f&&Qr.call(t,"__wrapped__"),g=d&&Qr.call(e,"__wrapped__");if(h||g){var m=h?t.value():t,b=g?e.value():e;return a||(a=new Q),o(m,b,r,n,a)}}return l?(a||(a=new Q),Wc(t,e,r,n,o,a)):!1}function _e(t,e,r,n,o){return t===e?!0:t==null||e==null||!Y(t)&&!Y(e)?t!==t&&e!==e:Jc(t,e,r,n,_e,o)}var Yc=1,qc=2;function Xc(t,e,r,n){var o=r.length,a=o,s=!n;if(t==null)return!a;for(t=Object(t);o--;){var i=r[o];if(s&&i[2]?i[1]!==t[i[0]]:!(i[0]in t))return!1}for(;++o<a;){i=r[o];var c=i[0],u=t[c],f=i[1];if(s&&i[2]){if(u===void 0&&!(c in t))return!1}else{var d=new Q;if(n)var l=n(u,f,c,t,e,d);if(!(l===void 0?_e(f,u,Yc|qc,n,d):l))return!1}}return!0}function Jr(t){return t===t&&!tt(t)}function Zc(t){for(var e=Tt(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,Jr(o)]}return e}function Yr(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}function Kc(t){var e=Zc(t);return e.length==1&&e[0][2]?Yr(e[0][0],e[0][1]):function(r){return r===t||Xc(r,t,e)}}function tu(t,e){return t!=null&&e in Object(t)}function eu(t,e,r){e=dt(e,t);for(var n=-1,o=e.length,a=!1;++n<o;){var s=ht(e[n]);if(!(a=t!=null&&r(t,s)))break;t=t[s]}return a||++n!=o?a:(o=t==null?0:t.length,!!o&&oe(o)&&ee(s,o)&&(P(t)||ie(t)))}function ru(t,e){return t!=null&&eu(t,e,tu)}var nu=1,ou=2;function au(t,e){return le(t)&&Jr(e)?Yr(ht(t),e):function(r){var n=_i(r,t);return n===void 0&&n===e?ru(r,t):_e(e,n,nu|ou)}}function iu(t){return function(e){return e==null?void 0:e[t]}}function su(t){return function(e){return Dt(e,t)}}function cu(t){return le(t)?iu(ht(t)):su(t)}function qr(t){return typeof t=="function"?t:t==null?nr:typeof t=="object"?P(t)?au(t[0],t[1]):Kc(t):cu(t)}function uu(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function lu(t,e){return e.length<2?t:Dt(t,Ti(e,0,-1))}var fu="Expected a function";function pu(t){if(typeof t!="function")throw new TypeError(fu);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function du(t,e){return e=dt(e,t),t=lu(t,e),t==null||delete t[ht(uu(e))]}function hu(t){return L(t)?void 0:t}var vu=1,mu=2,yu=4,gu=Ci(function(t,e){var r={};if(t==null)return r;var n=!1;e=Zt(e,function(a){return a=dt(a,t),n||(n=a.length>1),a}),_t(t,me(t),r),n&&(r=Nt(r,vu|mu|yu,hu));for(var o=e.length;o--;)du(r,e[o]);return r});const Xr=gu;function bu(t,e,r,n){if(!tt(t))return t;e=dt(e,t);for(var o=-1,a=e.length,s=a-1,i=t;i!=null&&++o<a;){var c=ht(e[o]),u=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(o!=s){var f=i[c];u=n?n(f,c,i):void 0,u===void 0&&(u=tt(f)?f:ee(e[o+1])?[]:{})}ne(i,c,u),i=i[c]}return t}function ju(t,e,r){for(var n=-1,o=e.length,a={};++n<o;){var s=e[n],i=Dt(t,s);r(i,s)&&bu(a,dt(s,t),i)}return a}function wu(t,e){if(t==null)return{};var r=Zt(me(t),function(n){return[n]});return e=qr(e),ju(t,r,function(n,o){return e(n,o[0])})}function _u(t,e){return wu(t,pu(qr(e)))}const Su=()=>K("normalObj",t=>!L(t)||[V.SLOT,V.EXPRESSION,V.FUNCTION].includes(t==null?void 0:t.type)?!1:(lt(t,jt(p(),Se)),!0)),Se=R([p(),Ye(),J(),S({type:I(V.SLOT),renderType:Qt([qt.FUNC,qt.COMP]),params:v(x(p())),value:ft(()=>R([vt,x(vt)]))}),S({type:I(V.EXPRESSION),value:p()}),S({type:I(V.FUNCTION),value:p()}),Su(),x(ft(()=>Se))]),Zr=S({type:I(V.EXPRESSION),value:p()}),vt=S({id:v(p()),title:v(p()),componentName:p(),props:v(jt(p(),Se)),stateName:v(p()),state:v(jt(p(),z())),children:ft(()=>v(x(R([p(),vt])))),configure:v(z()),style:v(p()),className:v(p()),refId:v(p()),extra:v(jt(z(),z())),condition:v(R([J(),Zr])),loop:v(S({open:J(),data:R([x(z()),Zr]),args:v(x(p())),name:v(p())}))}),Lt=R([p(),S({label:p(),tip:v(p())})]),Ou=S({type:I("shape"),value:x(S({name:p(),title:Lt,valueType:ft(()=>Bt)}))}),Cu=S({type:I("enums"),value:x(p())});S({type:I("array"),value:ft(()=>Bt)});const Eu=S({type:I("array"),value:ft(()=>x(Bt))}),Bt=R([Qt(["array","boolean","number","object","string"]),Qt(["component","expression","function"]),Ou,Cu,Eu]),Nu=R([p(),S({componentName:p(),props:z(),initialValue:z()})]),Oe=S({name:p(),title:Lt,valueType:Bt,description:v(p()),defaultValue:z(),setters:v(x(Nu)),condition:v(Je())}),Au=R([p(),Je()]);var Ce=(t=>(t.SINGLE="single",t.GROUP="group",t))(Ce||{});R([p(),S({name:p(),describe:v(p()),params:v(S({name:p(),description:p()})),template:p()})]);const Mu=S({id:v(p()),title:p(),snapshot:R([p(),z()]),description:v(p()),tags:v(x(p())),groupName:v(p()),category:v(p()),schema:Ht(Qe(vt,["id"]),S({componentName:v(p())}))}),$u=S({componentName:p(),title:p(),screenshot:v(p()),icon:v(p()),tags:v(x(p())),groupName:v(p()),category:v(p()),priority:v(Ye()),npm:R([Jt,I(!1)]),snippets:x(Mu),props:x(R([Oe,S({title:v(Lt),type:I("single"),content:Oe}),S({title:v(Lt),type:I("group"),content:x(Oe)})])),isContainer:v(R([J(),S({placeholder:p(),width:p(),height:p()})])),isModal:v(R([J(),S({visibleKey:p()})])),isSupportStyle:v(J()),isSupportDispatchNativeEvent:v(J()),isLayout:v(J()),rootSelector:v(p()),selectionToolBars:v(x(Au)),extra:v(jt(z(),z()))}),Pu=t=>({data:e,message:r,throwError:n})=>{const o=t({data:e,message:r,throwError:n});if(o.isValidate)return o;if(n)throw o.message||r?new Error(`${o.message||r}
 originData: ${JSON.stringify(e)}`):new Error(`${JSON.stringify(e)} 
 data struct format is invalidate`);return o},Ee=t=>{const{data:e,message:r,throwError:n,dataStruct:o}=t;return Pu(({data:a})=>{try{return He(a,o),{isValidate:!0}}catch(s){let i=s;return s instanceof Ve&&(i=s.failures().map(c=>`\u3010${c.path.join(".")}\u3011: ${c.message}
`)),{isValidate:!1,message:i,error:s}}})({data:e,message:r,throwError:n})};var Ne=(t=>(t.PAGE="Page",t))(Ne||{});const Tu=Ht(Qe(vt,["componentName"]),S({componentName:I("Page")}));function Ru(t){return{all:t=t||new Map,on:function(e,r){var n=t.get(e);n?n.push(r):t.set(e,[r])},off:function(e,r){var n=t.get(e);n&&(r?n.splice(n.indexOf(r)>>>0,1):t.set(e,[]))},emit:function(e,r){var n=t.get(e);n&&n.slice().map(function(o){o(r)}),(n=t.get("*"))&&n.slice().map(function(o){o(e,r)})}}}const At=Ru(),xu=(t,e)=>{const r={...t,value:[]},n=t.value;let o=new ut([]);return e&&(o=e.materialsMode||new ut([])),n&&(P(n)?r.value=n.map(a=>new A(a,{parent:e,materials:o})):L(n)&&r.value.push(new A(n,{parent:e,materials:o}))),r};class mt{constructor(e,r){y(this,"nodeType","SLOT"),y(this,"rawData"),y(this,"parent"),y(this,"emitter",At),y(this,"data"),y(this,"id"),y(this,"materialsMode"),this.parent=(r==null?void 0:r.parent)||null,this.rawData=e;const n=(r==null?void 0:r.materials)||new ut([]);this.materialsMode=n,this.id=Z(),this.data=xu(e,this)}get value(){return this.data}export(e){const r=this.data,n=o=>{if(o instanceof A)return o.export(e);if(L(o)){const a={};return Object.keys(o||{}).forEach(s=>{a[s]=n(o[s])}),a}return P(o)?o.map(a=>n(a)):(e==="design"&&delete o.id,o)};return n(r)}}const Kr=t=>{let e=[];return t.forEach(r=>{const n=r;n.type?n.type===Ce.SINGLE?e.push(n.content):n.type===Ce.GROUP&&(e=[...e,...Kr(n.content)]):e.push(r)}),e},Ae=(t,e,r)=>{if(t.type)return t.type===V.SLOT?new mt(t,{parent:e,materials:r}):t;if(L(t)){const n={};return Object.keys(t).forEach(o=>{n[o]=Me(t[o],e,r)}),n}else return Array.isArray(t)?t.map(n=>Ae(n,e,r)):t},Me=(t,e,r)=>L(t)?Ae(t,e,r):P(t)?t.map(n=>Ae(n,e,r)):t;class et{constructor(e,r,n){y(this,"nodeType","PROP"),y(this,"rawData"),y(this,"parent"),y(this,"emitter",At),y(this,"data"),y(this,"name"),y(this,"materialsMode");const o=(n==null?void 0:n.materials)||new ut([]);this.materialsMode=o,this.parent=n==null?void 0:n.parent,this.rawData=r,this.name=e,this.data=Me(r,this,o)}isIncludeSlot(){return!1}isIncludeExpression(){return!1}get value(){return this.data}updateValue(e){const r=this.data;this.data=Me(e!=null?e:r,this,this.materialsMode),this.emitter.emit("onPropChange",{value:this.data,preValue:r,node:this}),this.parent&&!(this.parent instanceof mt)&&this.emitter.emit("onNodeChange",{value:this.parent.value,preValue:this.parent.value,node:this.parent})}get material(){const e=this.parent;if(e instanceof A){const r=e.material;return Kr((r==null?void 0:r.value.props)||[]).find(n=>n.name===this.name)}else return null}export(e){const r=this.data,n=o=>{if(o instanceof et||o instanceof mt||o instanceof A)return o.export(e);if(P(o))return o.map(a=>n(a));if(L(o)){const a={};return Object.keys(o||{}).forEach(s=>{a[s]=n(o[s])}),a}return o};return n(r)}}const Du=t=>{if(typeof t=="string")return!0;Ee({data:t,dataStruct:vt,throwError:!0})},tn=(t,e,r=new ut([]))=>{var n;if(typeof t=="string")return t;const o={...t,id:(n=t.id)!=null?n:Z(),children:[],props:{}},a=Object.keys(t.props||{});return a.length&&a.forEach(s=>{var i;const c=(i=t.props)==null?void 0:i[s];if(c instanceof et){o.props[s]=c;return}o.props[s]=new et(s,c||"",{parent:e,materials:r})}),t.children&&(Array.isArray(t.children)?o.children=t.children.map(s=>{if(s instanceof A)return s;if(L(s)){const i=s;return new A(i,{parent:e,materials:r})}else return s}):(t.children instanceof A&&(o.children=[t.children]),o.children=[new A(t.children,{parent:e,materials:r})])),o};class A{constructor(e,r){y(this,"nodeType","NODE"),y(this,"rawData"),y(this,"data"),y(this,"emitter",At),y(this,"parent"),y(this,"materialsModel"),y(this,"listenerHandle"),y(this,"onChangeCbQueue"),this.rawData=JSON.parse(JSON.stringify(e)),Du(e);const n=(r==null?void 0:r.materials)||new ut([]);this.parent=(r==null?void 0:r.parent)||null,this.materialsModel=n,this.data=tn(e,this,n),this.listenerHandle=[],this.onChangeCbQueue=[],this.registerListener()}registerListener(){const e=r=>{const{node:n}=r;n===this&&n.id===this.id&&this.onChangeCbQueue.forEach(o=>o(r))};this.emitter.on("onNodeChange",e),this.listenerHandle.push(()=>{this.emitter.off("onNodeChange",e)})}onChange(e){return this.onChangeCbQueue.push(e),()=>{this.onChangeCbQueue=this.onChangeCbQueue.filter(r=>r!==e)}}destroy(){this.listenerHandle.forEach(e=>e())}get id(){return this.data.id}get value(){return this.data}clone(e){const r={...this.export("design"),id:e||Z()};return new A(r)}updateValue(e){const r=this.data,n={...this.data,...e};this.data=tn(n,this),this.emitter.emit("onNodeChange",{value:n,preValue:r,node:this})}contains(e){return xe(this,e)}get props(){return this.data.props}get material(){const e=this.materialsModel;return e==null?void 0:e.findByComponentName(this.data.componentName)}export(e){var r;const n=this.data;if(typeof n=="string")return n;const o={};Object.keys(n.props||{}).forEach(i=>{o[i]=n.props[i].export(e)});const a=(r=n.children)==null?void 0:r.map(i=>i instanceof A?i.export(e):i);let s={...n,props:o,children:a};return e==="design"&&delete s.id,s=Re(s),s}}const en=(t,e,r)=>{const n={...t,id:Z(),props:{},componentName:Ne.PAGE,children:[]};let o=[];P(t.children)?o=t.children.map(s=>s instanceof A?s:L(s)?new A(s,{parent:e,materials:r}):s):t.children instanceof A?o.push(t.children):t.children&&L(t.children)?o.push(new A(t.children,{parent:e,materials:r})):o.push(t.children,{parent:e});const a=Object.keys(t.props||{});return a.length&&a.forEach(s=>{var i;const c=(i=t.props)==null?void 0:i[s];c instanceof et?n.props[s]=c:n.props[s]=new et(s,c||"",{parent:e,materials:r})}),n.children=o,n};class $e{constructor(e,{parent:r,materials:n}){y(this,"rawData"),y(this,"data"),y(this,"nodeType","SCHEMA"),y(this,"emitter",At),y(this,"materialsModel"),y(this,"listenerHandle"),y(this,"onChangeCbQueue"),y(this,"parent"),this.materialsModel=n,this.rawData=JSON.parse(JSON.stringify(e)),this.data=en(e,this,n),this.listenerHandle=[],this.onChangeCbQueue=[],this.registerListener(),this.parent=r}registerListener(){const e=r=>{const{node:n}=r;n===this&&n.id===this.id&&this.onChangeCbQueue.forEach(o=>o(r))};this.emitter.on("onNodeChange",e),this.listenerHandle.push(()=>{this.emitter.off("onNodeChange",e)})}onChange(e){return this.onChangeCbQueue.push(e),()=>{this.onChangeCbQueue=this.onChangeCbQueue.filter(r=>r!==e)}}get id(){return this.data.id}get value(){return this.data}get props(){return this.data.props}get material(){const e=this.materialsModel;return e==null?void 0:e.findByComponentName(this.data.componentName)}updateValue(e){const r=this.data,n={...this.data,...e};this.data=en(n,this,this.materialsModel),this.emitter.emit("onNodeChange",{value:this.data,preValue:r,node:this})}contains(e){return xe(this,e)}export(e=Yt.SAVE){var r;const n=this.data,o={};Object.keys(n.props||{}).forEach(c=>{o[c]=n.props[c].export(e)});const a=(r=n.children)==null?void 0:r.map(c=>c.export(e)),s={...n,props:o,children:a};let i=Xr(s,["id"]);return i=Re(i),i}}const Pe=t=>(t==null?void 0:t.type)===V.EXPRESSION,Iu=t=>(t==null?void 0:t.type)==V.FUNCTION,Z=()=>Math.random().toString(32).slice(3,9),ku=t=>(t==null?void 0:t.nodeType)==="NODE",Te=t=>(t==null?void 0:t.nodeType)==="PROP",Fu=t=>(t==null?void 0:t.nodeType)==="SLOT",Re=t=>_u(t,e=>L(e)?!Object.keys(e).length:P(e)?!e.length:!e);function xe(t,e){const r=[t];for(;r.length;){const n=r.shift();if((n==null?void 0:n.id)===e)return n;const o=(n==null?void 0:n.props)||{},a=i=>{if(i instanceof A){r.push(i);return}if(i instanceof mt&&a(i.value.value),i instanceof et){a(i.value);return}if(L(i)){const c=i;Object.keys(c).map(u=>{a(c[u])});return}if(P(i)){i.forEach(c=>{a(c)});return}};a(o);const s=(n==null?void 0:n.value.children.filter(i=>i instanceof A))||[];r.push(...s)}return null}const Lu=t=>{const e=gc(t);return e.snippets=e.snippets.map(r=>({...r,id:r.id||`${t.componentName}-${Z()}`,title:r.title||t.title,category:r.category||t.category,tags:[...r.tags||[],...t.tags||[]],groupName:r.groupName||t.groupName,snapshot:r.snapshot||t.icon,schema:{...r.schema,componentName:r.schema.componentName||t.componentName}})),e};class Bu{constructor(e){y(this,"rawData"),y(this,"data"),this.rawData=e,this.data=Lu(e)}get value(){return this.data}get componentName(){return this.data.componentName}get snippets(){return this.data.snippets}getSnippetById(e){return this.data.snippets.find(r=>r.id===e)}}const Uu=t=>{if(!P(t))throw new Error("Materials must be a array");return t.map(e=>new Bu(e))},Gu=t=>{t==null||t.forEach(e=>{Ee({data:e,dataStruct:$u,throwError:!0})})};class ut{constructor(e){y(this,"rowData"),y(this,"data"),this.rowData=e,Gu(e),this.data=Uu(e)}findByComponentName(e){return this.data.find(r=>r.componentName===e)}findSnippetById(e){const r=[...this.data];let n=null;for(;!n&&r.length;){const o=r.pop();n=o==null?void 0:o.getSnippetById(e)}return n}getAllSnippets(){const e=this.data.reduce((a,s)=>(a.push(...s.snippets),a),[]),r=["default"],n={default:[]};e.forEach(a=>{const s=a.groupName||"default";r.includes(s)||(r.push(s),n[s]=[]),n[s].push(a)});const o=[];return r.forEach(a=>{const s=["default"],i={default:[]},c=n[a];if(c.length!==0){c.forEach(d=>{const l=d.category||"default";s.includes(l)||(s.push(l),i[l]=[]),i[l].push(d)});const u=[];s.forEach(d=>{i[d].length&&u.push({name:d,list:i[d]})});const f={name:a,list:u};o.push(f)}}),o}get value(){return this.data}}const zu=S({version:p(),pageName:p(),style:v(p()),css:v(p()),componentsMeta:x(Ht(S({componentName:p()}),Jt)),thirdLibs:v(zn),componentsTree:Tu}),Vu=t=>(Ee({data:t,dataStruct:zu,throwError:!0}),t),Wu=(t,e,r)=>({...t,componentsTree:new $e(t.componentsTree,{parent:e,materials:r})});class Ut{constructor(e,r){y(this,"nodeType","PAGE"),y(this,"rawData"),y(this,"emitter",At),y(this,"data"),y(this,"parent"),y(this,"materialsModel"),Vu(e),this.rawData=JSON.parse(JSON.stringify(e)),this.materialsModel=new ut((r==null?void 0:r.materials)||[]),this.data=Wu(e,this,this.materialsModel)}get value(){return this.data}getNode(e){const r=this.data.componentsTree;return xe(r,e)}addNode(e,r,n="AFTER"){var o,a,s;if(n==="AFTER"||n==="BEFORE"){const i=r.parent;if(i===null&&r instanceof $e)return console.warn("Not found parent node"),!1;if(i instanceof et)return console.warn("CProp can not add node"),!1;if(i instanceof mt){const u=i.value.value,f=(o=u.findIndex(d=>d===r))!=null?o:-1;return f>=0?(n==="BEFORE"?u.splice(f,0,e):u.splice(f+1,0,e),e.parent=i,(a=i.parent)==null||a.updateValue(),!0):!1}if(i instanceof Ut)return!1;const c=(s=i==null?void 0:i.value.children.findIndex(u=>u===r))!=null?s:-1;return c>=0?(n==="BEFORE"?i==null||i.value.children.splice(c,0,e):i==null||i.value.children.splice(c+1,0,e),e.parent=i,i==null||i.updateValue(),!0):(console.warn("Not found target node"),!1)}if(n==="CHILD_START")return r.value.children.unshift(e),e.parent=r,r.updateValue(),!0;if(n==="CHILD_END")return r.value.children.push(e),e.parent=r,r.updateValue(),!0;if(L(n)){const i=n;if(i.type==="CHILD"){const c=i.pos,u=i.index||0;return c==="BEFORE"?r==null||r.value.children.splice(u,0,e):r==null||r.value.children.splice(u+1,0,e),e.parent=r,r.updateValue(),!0}else console.warn("Can not parse pos obj")}return!1}createNode(e){return delete e.id,new A(e,{parent:null,materials:this.materialsModel})}addNodeById(e,r,n="AFTER"){const o=this.getNode(r);return o?this.addNode(e,o,n):(console.warn(`Not find a node by ${r}, pls check it`),!1)}copyNode(e){const r=e.export("design");r.id=Z();const n=new A(r,{parent:e.parent,materials:this.materialsModel});return this.addNode(n,e,"AFTER"),n}copyNodeById(e){const r=this.getNode(e);return r&&r instanceof A?this.copyNode(r):!1}moveNode(e,r,n){this.deleteNode(e);let o=r;return["AFTER","BEFORE"].includes(n)&&(o=r.parent),e.parent=o,this.addNode(e,r,n)}moveNodeById(e,r,n){const o=this.getNode(e),a=this.getNode(r);return o&&a&&o instanceof A&&a instanceof A?this.moveNode(o,a,n):!1}deleteNode(e){var r;const n=e.parent;if(!n)throw new Error("parent node is null or undefined, pls check it");if(n instanceof mt){const o=n.value.value,a=o.findIndex(i=>i===e),s=o[a];return o.splice(a,1),(r=n.parent)==null||r.updateValue(),s}if(n instanceof A||n instanceof $e){const o=n.value.children,a=o.findIndex(i=>i===e),s=o[a];return o.splice(a,1),n.updateValue(),s}}deleteNodeById(e){const r=this.getNode(e);if(r)return this.deleteNode(r)}export(e=Yt.SAVE){let r={...this.data,componentsTree:this.data.componentsTree.export(e)};return r=Xr(r,["id"]),r=Re(r),JSON.parse(JSON.stringify(r))}}var Hu=typeof global=="object"&&global&&global.Object===Object&&global;const Qu=Hu;var Ju=typeof self=="object"&&self&&self.Object===Object&&self,Yu=Qu||Ju||Function("return this")(),qu=Yu.Symbol;const yt=qu;var rn=Object.prototype,Xu=rn.hasOwnProperty,Zu=rn.toString,Mt=yt?yt.toStringTag:void 0;function Ku(t){var e=Xu.call(t,Mt),r=t[Mt];try{t[Mt]=void 0;var n=!0}catch{}var o=Zu.call(t);return n&&(e?t[Mt]=r:delete t[Mt]),o}var tl=Object.prototype,el=tl.toString;function rl(t){return el.call(t)}var nl="[object Null]",ol="[object Undefined]",nn=yt?yt.toStringTag:void 0;function on(t){return t==null?t===void 0?ol:nl:nn&&nn in Object(t)?Ku(t):rl(t)}function an(t){return t!=null&&typeof t=="object"}var al="[object Symbol]";function il(t){return typeof t=="symbol"||an(t)&&on(t)==al}function sl(t,e){for(var r=-1,n=t==null?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}var cl=Array.isArray;const De=cl;var ul=1/0,sn=yt?yt.prototype:void 0,cn=sn?sn.toString:void 0;function un(t){if(typeof t=="string")return t;if(De(t))return sl(t,un)+"";if(il(t))return cn?cn.call(t):"";var e=t+"";return e=="0"&&1/t==-ul?"-0":e}function ll(t,e){return function(r){return t(e(r))}}function ln(t){return t==null?"":un(t)}var fl=ll(Object.getPrototypeOf,Object);const pl=fl;var dl="[object Object]",hl=Function.prototype,vl=Object.prototype,fn=hl.toString,ml=vl.hasOwnProperty,yl=fn.call(Object);function Ie(t){if(!an(t)||on(t)!=dl)return!1;var e=pl(t);if(e===null)return!0;var r=ml.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&fn.call(r)==yl}function gl(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),r=r>o?o:r,r<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var a=Array(o);++n<o;)a[n]=t[n+e];return a}function bl(t,e,r){var n=t.length;return r=r===void 0?n:r,!e&&r>=n?t:gl(t,e,r)}var jl="\\ud800-\\udfff",wl="\\u0300-\\u036f",_l="\\ufe20-\\ufe2f",Sl="\\u20d0-\\u20ff",Ol=wl+_l+Sl,Cl="\\ufe0e\\ufe0f",El="\\u200d",Nl=RegExp("["+El+jl+Ol+Cl+"]");function pn(t){return Nl.test(t)}function Al(t){return t.split("")}var dn="\\ud800-\\udfff",Ml="\\u0300-\\u036f",$l="\\ufe20-\\ufe2f",Pl="\\u20d0-\\u20ff",Tl=Ml+$l+Pl,Rl="\\ufe0e\\ufe0f",xl="["+dn+"]",ke="["+Tl+"]",Fe="\\ud83c[\\udffb-\\udfff]",Dl="(?:"+ke+"|"+Fe+")",hn="[^"+dn+"]",vn="(?:\\ud83c[\\udde6-\\uddff]){2}",mn="[\\ud800-\\udbff][\\udc00-\\udfff]",Il="\\u200d",yn=Dl+"?",gn="["+Rl+"]?",kl="(?:"+Il+"(?:"+[hn,vn,mn].join("|")+")"+gn+yn+")*",Fl=gn+yn+kl,Ll="(?:"+[hn+ke+"?",ke,vn,mn,xl].join("|")+")",Bl=RegExp(Fe+"(?="+Fe+")|"+Ll+Fl,"g");function Ul(t){return t.match(Bl)||[]}function Gl(t){return pn(t)?Ul(t):Al(t)}function zl(t){return function(e){e=ln(e);var r=pn(e)?Gl(e):void 0,n=r?r[0]:e.charAt(0),o=r?bl(r,1).join(""):e.slice(1);return n[t]()+o}}var Vl=zl("toUpperCase");const Wl=Vl;function Hl(t){return Wl(ln(t).toLowerCase())}function Ql(t){const e=t.prototype;return!!(e&&e.isReactComponent)}function Jl(t){var n,o;const r=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.forward_ref"):60112;return(t==null?void 0:t.$$typeof)===r||((n=t==null?void 0:t.prototype)==null?void 0:n.isReactComponent)||((o=t==null?void 0:t.prototype)==null?void 0:o.setState)||t._forwardRef}function Yl(t){class e extends T.Component{render(){return T.createElement(t,this.props)}}return e.displayName=t.displayName,e}const Le=(t,e)=>{const r=n=>{const a=`
    ${Object.keys(e).map(s=>`const ${s} = $$context['${s}'];`).join(`
`)}
    return ${n};
    `;return new Function("$$context",a)(e)};try{return r(t)}catch(n){return console.warn(n),`[${t}] expression run failed`}},ql=(t,e,r)=>function(...o){try{const a=`
        var f = ${t};
        var args = Array.from(arguments);
        var __$$storeManager__ = args.pop();
        var $$context = args.pop();
        $$context.stateManager = __$$storeManager__.getStateSnapshot();
        return f.apply(f, args)
      `;new Function(a)(...o,e,r)}catch(a){console.warn(a)}},bn=(t,e)=>{const r={};return e.forEach((n,o)=>{r[n]=t[o]}),r},Gt="DYNAMIC",Xl=["$$context","$$nodeModel"],jn=t=>{let e;const r=new Set,n=(c,u)=>{const f=typeof c=="function"?c(e):c;if(!Object.is(f,e)){const d=e;e=(u!=null?u:typeof f!="object")?f:Object.assign({},e,f),r.forEach(l=>l(e,d))}},o=()=>e,i={setState:n,getState:o,subscribe:c=>(r.add(c),()=>r.delete(c)),destroy:()=>r.clear()};return e=t(n,o,i),i},Zl=t=>t?jn(t):jn;class Kl{constructor(){_(this,"storeMap",new Map)}addStore(e,r){const n=Zl(r);return this.storeMap.set(e,n),n.name=e,n}setStore(e,r){this.storeMap.set(e,r)}removeStore(e){this.storeMap.delete(e)}getStore(e){return this.storeMap.get(e)}connect(e,r){const n=this.storeMap.get(e);n?n.subscribe(r):console.warn("store not exits")}getStateSnapshot(){const e={};return this.storeMap.forEach((r,n)=>{e[n]={state:r.getState(),updateState:o=>{r.setState(o)}}}),e}destroy(){this.storeMap.forEach(e=>{e.destroy()}),this.storeMap=new Map}}class tf{constructor(){_(this,"components",{});_(this,"storeManager",new Kl);_(this,"runtimeComponentCache",new Map);_(this,"onGetRef");_(this,"onGetComponent");_(this,"onComponentMount");_(this,"onComponentDestroy")}getComponent(e){var o;const r=e.value.componentName;let n=this.components[r]||(()=>"Component not found");return Jl(n)||(n=Yl(n),this.components[r]=n),this.onGetComponent&&(n=(o=this.onGetComponent)==null?void 0:o.call(this,n,e)),n}getContext(e={},r){let n=e;return r&&(n={...e},n.__proto__=r||null),n}pageRender(e,{components:r,onGetRef:n,$$context:o={},onGetComponent:a,onComponentMount:s,onComponentDestroy:i}){this.components=r,this.onGetRef=n,this.onGetComponent=a,this.onComponentMount=s,this.onComponentDestroy=i;const c=e.value.componentsTree,u=this.getComponent(c),f=this.convertModelToComponent(u,e.value.componentsTree),d={},l=c.props;return Object.keys(l).forEach(h=>{d[h]=l[h].value}),d.$$context=o,this.render(f,d)}transformProps(e={},{$$context:r}){const n=e,o=s=>{if(Array.isArray(s))return s.map(i=>o(i));if(Te(s))return o(s.value);if(Fu(s)){const i=s.value,c=i.value;if(!c)return console.warn("slot value is null, this maybe cause some error, pls check it",e),()=>{};const u=f=>{const d=`${f.id}-${Gt}`;if(this.runtimeComponentCache.get(f.id))return{key:d,component:this.runtimeComponentCache.get(f.id)};const l=this.getComponent(f),h=this.convertModelToComponent(l,f),g=i.params||[],m=(...w)=>{const C=bn(w,g),M=this.getContext({params:C},r);return this.render(h,{$$context:M,key:d})};return this.runtimeComponentCache.set(f.id,m),{component:m,key:d}};if(Array.isArray(c)){const f=c==null?void 0:c.map(d=>u(d));return(...d)=>f.map(l=>Ql(l.component)?k.default.createElement(l.component,{$$context:r,key:l.key}):l.component(...d))}else return u(c).component}else{if(Pe(s))return Le(s.value,r||{});if(Iu(s))return ql(s.value,r,this.storeManager);if(Ie(s)){let i=s;Te(s)&&(i=s.value);const c=i,u={};return Object.keys(i).forEach(f=>{u[f]=o(c[f])}),u}else return s}},a={};return Object.keys(n).forEach(s=>{const i=n[s];a[s]=o(i)}),a}collectSpecialProps(e={},r){const n=[],o=(a,s)=>{let i=s;Te(s)&&(i=s.value),r(i)?n.push({keyPath:a,val:i}):De(i)?i.forEach((c,u)=>{o([...a,String(u)],c)}):Ie(i)&&Object.keys(i).forEach(c=>{o([...a,c],i[c])})};return o(["$root"],e),n}convertModelToComponent(e,r){const n=this;class o extends k.default.Component{constructor(i){super(i);_(this,"NODE_ID",r.id);_(this,"UNIQUE_ID",`${r.id}_${Z()}`);_(this,"targetComponentRef");_(this,"listenerHandle",[]);_(this,"storeState");_(this,"updateState",i=>{this.storeState.setState(i),this.forceUpdate()});this.targetComponentRef=k.default.createRef(),this.state=r.value.state||{};const c=r.value.stateName||r.id,u=n.storeManager.getStore(c);u?(this.storeState=u,u.setState({...r.value.state||{}})):this.storeState=n.storeManager.addStore(c,()=>({...r.value.state||{}})),this.storeState.subscribe(f=>{this.setState({...f})}),this.connectStore()}connectStore(){const c=n.collectSpecialProps(r.props,u=>!!Pe(u)).map(u=>{const f=u.val,l=/\$\$context.stateManager\.(.+?)\./gim.exec(f.value);return l!=null&&l.length?l[1]:""}).filter(Boolean);c.length&&c.forEach(u=>{n.storeManager.getStore(u)||n.storeManager.addStore(u,()=>({})),n.storeManager.connect(u,()=>{this.forceUpdate()})})}componentDidMount(){var c;n.onGetRef&&n.onGetRef(this.targetComponentRef,r,this),(c=n.onComponentMount)==null||c.call(n,this,r);const i=()=>{n.storeManager.setStore(r.value.stateName||r.id,this.storeState),this.forceUpdate()};r.onChange(i)}componentWillUnmount(){var i;(i=n.onComponentDestroy)==null||i.call(n,this,r)}render(){var C;const{$$context:i,...c}=this.props,u={key:r.id,...r.props,...c},f={state:this.state||{},updateState:this.updateState};r.value.componentName===Ne.PAGE&&(f.globalState=this.state,f.updateGlobalState=this.updateState),f.stateManager=n.storeManager.getStateSnapshot();const d=n.getContext(f,i);let l=(C=r.value.condition)!=null?C:!0;if(typeof l!="boolean"&&(l=Le(l.value,d||{})),!l)return null;const h=r.value.loop;let g=[];if(h&&h.open){this.targetComponentRef.current=[];let M=[];if(Pe(h.data)){const $=h.data;M=Le($.value,d||{})}return g=M.map((...$)=>{const D=$[1],U=h.args||["item","index"],N=bn($,U);let gt="loopData";h.name&&(gt=`${gt}${Hl(h.name)}`);const bt=n.getContext({[gt]:N},d),rt=n.transformProps(u,{$$context:bt}),{children:zt}=rt;let Ue=[];if(zt!==void 0)delete rt.children,Ue=Array.isArray(zt)?zt:[zt];else{const Vt=[];r.value.children.forEach((ff,pf)=>{const df=n.buildComponent(ff,{$$context:d,idx:pf});Vt.push(df)}),Ue=Vt}return rt.key=`${rt.key}-${D}`,rt.ref=Vt=>{this.targetComponentRef.current[D]=Vt},n.render(e,rt,...Ue)}),g}const m=n.transformProps(u,{$$context:d}),{children:b}=m;let w=[];if(b!==void 0)delete m.children,w=Array.isArray(b)?b:[b];else{const M=[];r.value.children.forEach((D,U)=>{const N=n.buildComponent(D,{$$context:d,idx:U});M.push(N)}),w=M}return m.ref=this.targetComponentRef,n.render(e,m,...w)}}return _(o,"__CP_TYPE__",Gt),o.displayName=`${r.value.componentName}Dynamic`,o}buildComponent(e,{$$context:r={}}){const n=this.runtimeComponentCache;return typeof e=="string"?this.render(e):ku(e)?(({currentNode:a})=>{const s=a.value.id;let i=null;if(n.get(s))i=n.get(s);else{const f=this.getComponent(a);i=this.convertModelToComponent(f,a)}n.get(s)||n.set(s,i);const c=`${s}-${Gt}`,u={$$context:r,$$nodeModel:e,key:c};return this.render(i,u)})({currentNode:e}):void 0}render(e,r={},...n){return typeof e=="string"||typeof e=="number"?String(e):(Xl.forEach(a=>{a in r&&e.__CP_TYPE__!==Gt&&delete r[a]}),k.default.createElement(e,r,...n))}clear(){this.runtimeComponentCache.clear(),this.storeManager.destroy()}}const ef=ze(new tf),rf=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","content","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","element","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","image","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marquee","math","menu","menuitem","meta","meter","multicol","nav","nextid","nobr","noembed","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","plaintext","pre","progress","q","rb","rbc","rp","rt","rtc","ruby","s","samp","script","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"].reduce((t,e)=>(t[e]=({children:r,...n})=>{let o=r;return Array.isArray(r)||(o=[r]),k.default.createElement(e,n,...o)},t),{}),nf={Page:({children:t})=>t,...rf};class of{constructor(){_(this,"refMap",new Map)}get(e){return this.refMap.get(e)}add(e,r){this.refMap.set(e,r)}remove(e){this.refMap.delete(e)}destroy(){this.refMap.clear()}}class wn extends k.default.Component{constructor(r){super(r);_(this,"refManager");_(this,"rerender",r=>{var n;this.props.adapter.clear(),this.setState({pageModel:new Ut(r)}),(n=this.state.pageModel)==null||n.emitter.emit("onNodeChange",{value:r,preValue:this.state.pageModel,node:this.state.pageModel})});_(this,"onGetRef",(r,n,o)=>{var a,s;(s=(a=this.props).onGetRef)==null||s.call(a,r,n,o),this.refManager.add(n.value.refId||n.id,r)});this.state={pageModel:r.pageModel||new Ut(r.page)},this.refManager=new of}getPageModel(){return this.state.pageModel}componentDidMount(){const{render:r}=this.props;r&&(r.ref.current=this)}componentWillUnmount(){this.refManager.destroy()}render(){const{props:r}=this,{adapter:n,onGetComponent:o,onComponentDestroy:a,onComponentMount:s}=r,{pageModel:i}=this.state;if(!i)return null;const c={...nf,...r.components};return n.pageRender(i,{libs:{},components:c,onGetRef:this.onGetRef,onGetComponent:o,onComponentMount:s,onComponentDestroy:a,$$context:{refs:this.refManager}})}}const af=()=>{const t=T.useRef(null);return{ref:t,rerender:function(...e){t.current&&t.current.rerender(...e)}}};class _n{constructor(){_(this,"instanceMap",new Map)}get(e){return this.instanceMap.get(e)}add(e,r){const n=this.instanceMap.get(e);n?n.push(r):this.instanceMap.set(e,[r])}remove(e,r){const n=this.instanceMap.get(e);if(r!==void 0&&Array.isArray(n)){const o=n.filter(a=>a===r);this.instanceMap.set(e,o)}else this.instanceMap.delete(e)}destroy(){this.instanceMap.clear()}}const Sn=t=>{const{node:e}=t,r=T.useMemo(()=>{var c;const i=(c=e.material)==null?void 0:c.value.isContainer;return i&&Ie(i)?i:{placeholder:"Drag the component to place it",width:"100%",height:"100%",style:{}}},[t.node]),{placeholder:n,height:o,width:a,style:s}=r;return k.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(200,200,200,0.1)",border:"1px solid rgba(0,0,0,0.1)",borderRadius:"2px",fontSize:"14px",color:"gray",cursor:"default",minWidth:"300px",minHeight:"50px",width:a,height:o,...s}},n)};class sf extends k.default.Component{constructor(r){super(r);_(this,"instanceManager",new _n);_(this,"renderRef");_(this,"dropPlaceholder",Sn);_(this,"onGetComponent",(r,n)=>{const o=this;class a extends k.default.Component{constructor(){super(...arguments);_(this,"_DESIGN_BOX",!0);_(this,"_NODE_MODEL",n);_(this,"_NODE_ID",n.id);_(this,"_UNIQUE_ID",`${n.id}_${Z()}`);_(this,"_STATUS")}componentDidMount(){o.instanceManager.add(n.id,this)}componentWillUnmount(){o.instanceManager.remove(n.id,this),this._STATUS="DESTROY"}render(){var l;const{children:c=[],...u}=this.props;let f=c;return De(c)||(f=[c]),!Boolean(f.filter(Boolean).length)&&((l=n.material)==null?void 0:l.value.isContainer)&&f.push(k.default.createElement(o.dropPlaceholder,{node:n})),k.default.createElement(r,u,...f)}}return a});this.renderRef=k.default.createRef(),r.dropPlaceholder&&(this.dropPlaceholder=r.dropPlaceholder)}componentDidMount(){var r,n;(n=(r=this.props).onMount)==null||n.call(r,this)}getPageModel(){var r;return(r=this.renderRef.current)==null?void 0:r.state.pageModel}rerender(r){var n;return(n=this.renderRef.current)==null?void 0:n.rerender(r)}getInstancesById(r,n){let o=[...this.instanceManager.get(r)||[]];return n!==void 0&&(o=o.filter(a=>n===(a==null?void 0:a._UNIQUE_ID))),o}getInstanceByDom(r){const n=On(r);if(!n)return null;const o=Cn(n);return(o==null?void 0:o.stateNode)||null}getDomsById(r,n){const o=this.getInstancesById(r),a=[];return o==null||o.forEach(s=>{if((s==null?void 0:s._STATUS)==="DESTROY")return;const i=$n.findDOMNode(s);if(i&&!(i instanceof Text))if(n){const c=Array.from(i.querySelectorAll(n));a.push(...c)}else a.push(i)}),a}getDomRectById(r,n){return this.getDomsById(r,n).map(s=>s==null?void 0:s.getBoundingClientRect()).filter(Boolean)}render(){const{props:r,onGetComponent:n}=this,{render:o,...a}=r;return o&&(o.ref.current=this),k.default.createElement(wn,{onGetComponent:n,...a,ref:this.renderRef})}}const On=t=>{if(!t)return null;const e=Object.keys(t).find(r=>r.startsWith("__reactInternalInstance$")||r.startsWith("__reactFiber$"))||"";return e?t[e]:On(t.parentElement)},Cn=t=>{var e;return t?(e=t==null?void 0:t.stateNode)!=null&&e._DESIGN_BOX?t:Cn(t.return):null},cf=()=>{const t=T.useRef(null);return{ref:t,rerender:function(...e){t.current&&t.current.rerender(...e)},getInstancesById(e,r){var n;return((n=t.current)==null?void 0:n.getInstancesById(e,r))||[]},getInstanceByDom(e){var r;return(r=t.current)==null?void 0:r.getInstanceByDom(e)},getDomsById(e,r){var n;return((n=t.current)==null?void 0:n.getDomsById(e,r))||[]},getDomRectById(e,r){var n;return((n=t.current)==null?void 0:n.getDomRectById(e,r))||[]}}};var uf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},En={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(uf,function(){var r=function(){},n={},o={},a={};function s(l,h){l=l.push?l:[l];var g=[],m=l.length,b=m,w,C,M,$;for(w=function(D,U){U.length&&g.push(D),b--,b||h(g)};m--;){if(C=l[m],M=o[C],M){w(C,M);continue}$=a[C]=a[C]||[],$.push(w)}}function i(l,h){if(!!l){var g=a[l];if(o[l]=h,!!g)for(;g.length;)g[0](l,h),g.splice(0,1)}}function c(l,h){l.call&&(l={success:l}),h.length?(l.error||r)(h):(l.success||r)(l)}function u(l,h,g,m){var b=document,w=g.async,C=(g.numRetries||0)+1,M=g.before||r,$=l.replace(/[\?|#].*$/,""),D=l.replace(/^(css|img)!/,""),U,N;m=m||0,/(^css!|\.css$)/.test($)?(N=b.createElement("link"),N.rel="stylesheet",N.href=D,U="hideFocus"in N,U&&N.relList&&(U=0,N.rel="preload",N.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test($)?(N=b.createElement("img"),N.src=D):(N=b.createElement("script"),N.src=l,N.async=w===void 0?!0:w),N.onload=N.onerror=N.onbeforeload=function(gt){var bt=gt.type[0];if(U)try{N.sheet.cssText.length||(bt="e")}catch(rt){rt.code!=18&&(bt="e")}if(bt=="e"){if(m+=1,m<C)return u(l,h,g,m)}else if(N.rel=="preload"&&N.as=="style")return N.rel="stylesheet";h(l,bt,gt.defaultPrevented)},M(l,N)!==!1&&b.head.appendChild(N)}function f(l,h,g){l=l.push?l:[l];var m=l.length,b=m,w=[],C,M;for(C=function($,D,U){if(D=="e"&&w.push($),D=="b")if(U)w.push($);else return;m--,m||h(w)},M=0;M<b;M++)u(l[M],C,g)}function d(l,h,g){var m,b;if(h&&h.trim&&(m=h),b=(m?g:h)||{},m){if(m in n)throw"LoadJS";n[m]=!0}function w(C,M){f(l,function($){c(b,$),C&&c({success:C,error:M},$),i(m,$)},b)}if(b.returnPromise)return new Promise(w);w()}return d.ready=function(h,g){return s(h,function(m){c(g,m)}),d},d.done=function(h){i(h,[])},d.reset=function(){n={},o={},a={}},d.isDefined=function(h){return h in n},d})})(En);const Be=En.exports,Nn=t=>!!((t==null?void 0:t.name)&&(t==null?void 0:t.assets));class lf{constructor(e){_(this,"assets");_(this,"loadStatus");_(this,"_onSuccessList",[]);_(this,"_onErrorList",[]);this.assets=e,this.loadStatus="INIT"}load(){const e=this.assets||[],r=[];for(let n=0;n<e.length;n++){const o=e[n];if(o.id||(o.id=Z()),r.push(o.id),Nn(o)){const a=o.assets.map(s=>s.src);Be(a,o.id)}else Be(o.src,o.id)}return setTimeout(()=>{Be.ready(r,{success:()=>{this._onSuccessList.forEach(n=>n())},error:n=>{this._onErrorList.forEach(o=>o(n))}})},0),this}onSuccess(e){return this._onSuccessList.push(e),this}onError(e){return this._onErrorList.push(e),this}}j.AssetLoader=lf,j.ComponentInstanceManager=_n,j.DefaultDropPlaceholder=Sn,j.DesignRender=sf,j.ReactAdapter=ef,j.Render=wn,j.getAdapter=ze,j.isAssetPackage=Nn,j.useDesignRender=cf,j.useRender=af,Object.defineProperties(j,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=index.umd.js.map
